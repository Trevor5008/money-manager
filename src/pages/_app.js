import { SessionProvider } from "next-auth/react"
import { useEffect, useState } from "react"
import { lightTheme, darkTheme } from "@/styles/themes"
import { CssBaseline } from "@mui/material"
import { ThemeProvider } from "@mui/material/styles"
import Head from "next/head"
import "@/styles/globals.scss"

export default function App({
   Component,
   pageProps: { session, ...pageProps }
}) {
   const [render, setRender] = useState(false)
   const [isDark, setIsDark] = useState(false)

   useEffect(() => {
      setRender(true)
   }, [session])

   if (typeof window === "undefined") return null

   // Toggle b/n light and dark theme
   const handleSwitch = () => setIsDark(!isDark)

   return render ? (
      <>
         <Head>
            <title>Money Manager</title>
            <meta
               name="description"
               content="Generated by create next app"
            />
            <meta
               name="viewport"
               content="width=device-width, initial-scale=1"
            />
            <link
               rel="icon"
               href="/money-mgr-favicon.ico"
            />
         </Head>
         <ThemeProvider theme={isDark ? darkTheme : lightTheme}>
            <SessionProvider session={session}>
               <CssBaseline />
               <Component
                  {...pageProps}
                  handleSwitch={handleSwitch}
               />
            </SessionProvider>
         </ThemeProvider>
      </>
   ) : null
}
